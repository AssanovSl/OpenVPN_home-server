# OpenVPN home server #  
### Работа по настройке домашнего VPN сервера на роутере Keenetic ###
Проект по развертыванию безопасного VPN-сервера на роутере Keenetic для безопасного удаленного доступа к домашней лабораторной среде. Решение обеспечивает шифрованное подключение к виртуальным машинам и сетевым ресурсам, а также перенаправляет весь трафик клиента через домашний интернет-канал.

###  Поставленные цели ###
- Подключение к домашней сети из любого места через интернет.
- Доступ к локальным устройствам (сервер, видеонаблюдение и ВМ).
- Безопасный выход в интернет через роутер.
- Управление доступом с помощью клиентских сертификатов.
- Сохраненеие безопасности локальной сети. 

### Инструменты и технологии ###
- **Сетевое оборудование:** Роутер Keenetic Giga (прошивка KeeneticOS)
- **VPN-решение:** OpenVPN
- **Аутентификация:** TLS + логин/пароль
- **Клиенты:** OpenVPN Connect (iOS/Android), network-manager (Linux) 

## Структура проекта
- `scripts/` — Bash-скрипты для генерации ключей.
- `docs/` — инструкция и отчет о проделанной работе.  
- `configs/` — примеры готовых конфигураций.  

**Скрипты:**
- `init-ca.sh` — создание корневого сертификата CA  
- `gen-server.sh` — генерация ключей и сертификата сервера  
- `gen-client.sh` — генерация ключей и сертификата клиента  
- `gen-dh.sh` — генерация параметров Диффи-Хеллмана  
- `gen-ta-key.sh` — генерация TLS-ключа HMAC (ta.key)

**Конфигурации:**
- `server.ovpn` / `client.ovpn` — работа через PKI (сертификаты)  
- `server-static.ovpn` / `client-static.ovpn` — тестовый режим со статическим ключом  

## Быстрый старт ##

1. **Создание инфраструктуры PKI:**
При помощи скриптов создать необходимые файлы:  
`scripts/gen-server.sh`  
`scripts/gen-client.sh`  
`scripts/init-ca.sh`  
`scripts/gen-dh.sh`  
`scripts/get-ta-key.sh`  
Использовать их в конфигурационном файле.  
2. **Настройка сервера на Keenetic**  
В веб-интерфейсе добавить компонент "Клиент и сервер OpenVPN"  
Добавить подключение: другие подключения - VPN - добавить оединение, выбрать тип OpenVPN.  
Вставить содержимое конфига.
3. **Настройки роутера**  
Настроить NAT, firewall и открыть порт, указанный в конфиге.  
4. **Настройка клиента**  
Импортировать client.ovpn в OpenVPN Connect или NetworkManager.
Подключиться к серверу и проверить доступ к домашней сети.


## Дополнительно ##
Подробнее о настройке и конфигурации VPN см. **docs/report.md**  
Статический ключ (static key) подходит только для тестирования, а для боевого использования рекомендуется PKI/TLS.  
TLS HMAC (ta.key) защищает сервер от DoS-атак и неавторизованного доступа.  


## Выводы ##
- Освоена настройка VPN-сервера на роутере Keenetic через веб-интерфейс и CLI.  
- Настроены два режима работы OpenVPN: статический ключ (для тестов) и PKI/TLS (для боевого использования).  
- Получен опыт генерации ключей и сертификатов с использованием скриптов и OpenSSL.  
- Настроен безопасный доступ к домашней сети и локальным ресурсам для клиентов.  
- Реализовано перенаправление клиентского интернет-трафика через домашний роутер.  
- Изучены механизмы защиты соединения: TLS HMAC, Диффи-Хеллман, шифрование AES-256-CBC и аутентификация SHA256.  
- Подготовлены готовые конфигурации для сервера и клиентов, обеспечивающие воспроизводимость проекта.


## Полезные ссылки ##  
- [Keenetic: Клиент и сервер OpenVPN](https://support.keenetic.ru/eaeu/ultra/kn-1810/ru/17194-openvpn-client-and-server.html)  
- [Keenetic: 
Конфигурация OpenVPN с использованием двусторонней TLS аутентификации](https://help.keenetic.com/hc/ru/articles/12514441230108-%D0%9A%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F-OpenVPN-%D1%81-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC-%D0%B4%D0%B2%D1%83%D1%81%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%BD%D0%B5%D0%B9-TLS-%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B8)
- [Документация OpenVPN](https://openvpn.net/community-resources/reference-manual-for-openvpn-2-4/)  
- [Статья по PKI и сертификатам OpenVPN](https://www.digitalocean.com/community/tutorials/how-to-set-up-an-openvpn-server-on-ubuntu-20-04)  
- [OpenSSL руководство](https://www.openssl.org/docs/)  
